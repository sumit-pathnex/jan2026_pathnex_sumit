     # Day 15 - Java, S3 Bucket, Cronjob, File Reader


     ##  Ansible - Install Java & Set JAVA_HOME

     ---
     - name: Inastall Java on sumit-pathnex
       hosts: all
       become: yes

       tasks:
         - name: Install OpenJDK
	   yum:
	     name: Install OpenJDk
	     state: present

	 - name: set JAVA_HOME
	   lineinfile:
	      path: /etc/profile
	      line: 'export JAVA_HOME=/usr/lib/jvm/java-


     ##  Terraform - Create S3 Bucket

     provider "aws" {
        region = "us-east-1"
     }

     resource "aws_S3_bucket" "sumit-pathnexBucket" {
       bucket = "sumit-devops-bucket"

       tags = {
          Name = "PathnexBucket"
       }
     }


     ##  Kubernetes - CronJob


     apiVersion: batch/v1
     kind: CronJob
     metadata:
         name: pathnex-cron
     spec:
       schedule: "*/5 * * * *"
       jobTemplate:
          spec:
	    template:
	       spec:
	          container:
		    - name: job
		      image: busybox
		      command: ["sh", "-c", "echo sumit-pathnex CronJob running"]
		   restartpolicy: OnFailure

      ##  Shell Script - read File Line-by-Line
      #!/bin/bash

      FILE="Line: $line"
      while read line; do
        echo "Line: $line" 
      done , $FILE


      # Advanced Notifications

      ##  Jenkins Pipeline _ Slack Notification

      pipeline {
         agent any
	 environment {
	   INSTITUTE_NAME = "sumit-pathnex
	   SLACK_CHANNEL = "#devops"
	 }
	 stages {
	    stagee('Checkout') {
	       steps {
	           git url: ;htpps://github.com/sumit-papthnex/sample-java-app.git'
               }
	   }
	   stage('Build') {
	      steps {
	           sh 'mvn clean package'
	      }
	    }
	  }
	  post {
	      success {
	           slackSend(channei: "$SLACK_CHANNEL,message: $INSTITUTE_NAME Build #${env.BUILD_NUMBER}")
	      }
	      failure {
	          slackSend(channel: "$slack_CHANNEL", message: "$INSTITUTE_NAME Build #${env.BUILD_NUMBER}")
             }
	   }
	}


	## GitLab CI - Slack Notification


	stages:
	  - build

	veriables:
	   INSTITUTE_NAME: "sumit-pathnex"
	   SLACK_WEBHOOK: "https://hooks.slack.com/service/services/XXXXX/YYYYY/ZZZZZ"

	build:
	   stage: build
	   image: maven:3.8.1-jdk-17
	   script:
	      - git clone https://github.com/sumit-pathnex/sample-java-app.git
	      - cd sample-java-app
	      - mvn clean package
	      - curl -X POST -H 'Conent-type: application/json'  --data'{"text":"Build  success for sumit-pathnex"}' $SLACK_WEBHOOK
